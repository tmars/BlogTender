{% import 'BTBundle:Frontend/Base:forms.html.twig' as forms %}

{{ tinymce_init() }}

<script>
jQuery(document).ready(function($) {
    $("#post_tags").select2({
        initSelection : function (element, callback) {
            alert('sd');
            var data = [];
            $(element.val().split(", ")).each(function () {
                data.push({id: this, text: this});
            });
            callback(data);
        },
        createSearchChoice: function(term, data) {
            alert('sd');
            if ($(data).filter(function() { return this.text.localeCompare(term)===0; }).length===0)
            {return {id:term, text:term};alert('s')}
        },
        multiple: true,
        width: 'element',
        data: [
            {% for tag in env.tags %}
            {id: '{{ tag.label }}', text: '{{ tag.label }}'}{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    });
    $("#post_tags")
        .on("change", function(e) { console.log(JSON.stringify({val:e.val, added:e.added, removed:e.removed})) } );
});
</script>
{{ form_stylesheet(form) }}

{{ forms.errors(form) }}
{{ forms.row(form._token) }}
{{ form_widget(form.pub_flag) }}

{{ forms.row(form.categories) }}
{% if post is defined and post.image %}
<img src="{{ post.preview | apply_filter('post_image_mini') }}">
{% endif %}
{{ forms.row(form.image) }}
{{ forms.row(form.title) }}
{{ forms.row(form.content) }}
{{ forms.row(form.tags) }}

<input type="submit" value="Сохранить" onclick="$('#post_pub_flag').val(0)">
